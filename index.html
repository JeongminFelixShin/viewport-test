<!DOCTYPE html>
<html lang="en">
<head>
  <title>Common Preview</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">
</head>
<body>
<div class="contents"></div>
<script>
  var contentFixedWidth = 'width=768,maximum-scale=1.0';
  var contentDeviceWidth = 'width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0';

  var resizeOrientationChange = function() {
    var el = document.querySelector('.contents');
    el.innerHTML += 'resize on orientation change<br>'
    el.innerHTML += 'innerWidth: ' + window.innerWidth + '<br>';
    el.innerHTML += 'outerWidth: ' + window.outerWidth + '<br><br>';
    window.removeEventListener('resize', resizeOrientationChange);
  };

  window.addEventListener('resize', function() {
    var el = document.querySelector('.contents');
    var inner = el.innerHTML;
    inner += 'resize<br>';
    inner += 'innerWidth: ' + window.innerWidth + '<br>';
    inner += 'outerWidth: ' + window.outerWidth + '<br>';
    el.innerHTML = inner;

    var timeout = 0;

    var checkOuterWidth = function() {
      if (timeout < 100) {
        el.innerHTML += 'reqAnimFrame outerWidth: ' + window.outerWidth + '<br>';
        timeout++;
        requestAnimationFrame(checkOuterWidth);
      }
    };

    requestAnimationFrame(checkOuterWidth);

    // var meta = document.querySelector('meta[name="viewport"]');
    // var content = meta.getAttribute('content');
    //
    // if (window.outerWidth < 768 && window.outerWidth > 534) {
    //   if (content !== contentFixedWidth) {
    //     meta.setAttribute('content', contentFixedWidth);
    //     el.innerHTML += 'current meta: fixed<br>';
    //   }
    // } else {
    //   if (content !== contentDeviceWidth) {
    //     meta.setAttribute('content', contentDeviceWidth);
    //     el.innerHTML += 'current meta: device width<br>';
    //   }
    // }
    el.innerHTML += '<br>';
  });

  window.addEventListener('orientationchange', function() {
    var el = document.querySelector('.contents');
    el.innerHTML = '';
    var inner = el.innerHTML;
    inner += 'orientationchange<br>';
    inner += 'innerWidth: ' + window.innerWidth + '<br>';
    inner += 'outerWidth: ' + window.outerWidth + '<br><br>';
    el.innerHTML = inner;

    window.addEventListener('resize', resizeOrientationChange);
  });

  // window.onload = function() {
  //   var el = document.querySelector('.contents');
  //   var meta = document.querySelector('meta[name="viewport"]');
  //   var content = meta.getAttribute('content');
  //
  //   if (window.outerWidth < 768 && window.outerWidth > 534) {
  //     if (content !== contentFixedWidth) {
  //       meta.setAttribute('content', contentFixedWidth);
  //       el.innerHTML += 'current meta: fixed<br>';
  //     }
  //
  //   } else {
  //     if (content !== contentDeviceWidth) {
  //       meta.setAttribute('content', contentDeviceWidth);
  //       el.innerHTML += 'current meta: device width<br>';
  //     }
  //   }
  // }
</script>
</body>
</html>
